cmake_minimum_required(VERSION 3.0)

macro(TEST TEST_NAME)
  add_executable(${TEST_NAME} "${TEST_NAME}.cpp")
  target_link_libraries(${TEST_NAME} core gtest_main)
  set(DEPENDENCIES "${ARGN}")
  foreach(DEPENDENCY IN LISTS DEPENDENCIES)
    target_link_libraries(${TEST_NAME} ${DEPENDENCY})
  endforeach()
  # set_target_properties(${TEST_NAME} PROPERTIES FOLDER "tests"
  #   RUNTIME_OUTPUT_DIRECTORY "${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/tests")
endmacro(TEST)

TEST(AssetsTest assets)
TEST(CoreTest io)
TEST(NavTest nav assets)
TEST(IOTest io)
TEST(GeoTest geo)
TEST(Mp3dTest scene)
TEST(SuncgTest scene)
TEST(main)

# file(GLOB_RECURSE TEST_SRCS "*.cpp")
# foreach(test_src ${TEST_SRCS})
#   get_filename_component(test_name ${test_src} NAME_WE)
#   add_executable(${test_name} "${test_src}")
#   # target_link_libraries(${test_name} ${Caffe2_MAIN_LIBS} gtest_main)
#   target_link_libraries(${test_name} assets glog gtest_main)
#   add_test(NAME ${test_name} COMMAND $<TARGET_FILE:${test_name}>)
# endforeach()
